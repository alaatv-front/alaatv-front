<template>
  <div class="StepSection">
    <div class="items">
      <div v-for="(video, videoIndex) in localBlackFridayCampaignData.videos.list"
           :key="videoIndex"
           class="item"
           :class="{ 'unlock': video.is_actice, 'lock': !video.is_actice, 'current': isCurrent(videoIndex) }">
        <q-btn @click="onSelectStep(videoIndex)">
          <svg v-if="!video.is_actice"
               xmlns="http://www.w3.org/2000/svg"
               width="21"
               height="20"
               viewBox="0 0 21 20"
               fill="none">
            <path d="M16.3929 6.25H13.8929V4.375C13.8929 3.38044 13.4979 2.42661 12.7946 1.72335C12.0913 1.02009 11.1375 0.625 10.1429 0.625C9.14838 0.625 8.19456 1.02009 7.49129 1.72335C6.78803 2.42661 6.39294 3.38044 6.39294 4.375V6.25H3.89294C3.56142 6.25 3.24348 6.3817 3.00906 6.61612C2.77464 6.85054 2.64294 7.16848 2.64294 7.5V16.25C2.64294 16.5815 2.77464 16.8995 3.00906 17.1339C3.24348 17.3683 3.56142 17.5 3.89294 17.5H16.3929C16.7245 17.5 17.0424 17.3683 17.2768 17.1339C17.5112 16.8995 17.6429 16.5815 17.6429 16.25V7.5C17.6429 7.16848 17.5112 6.85054 17.2768 6.61612C17.0424 6.3817 16.7245 6.25 16.3929 6.25ZM10.1429 12.8125C9.95752 12.8125 9.77627 12.7575 9.6221 12.6545C9.46793 12.5515 9.34776 12.4051 9.27681 12.2338C9.20585 12.0625 9.18728 11.874 9.22346 11.6921C9.25963 11.5102 9.34892 11.3432 9.48003 11.2121C9.61114 11.081 9.77819 10.9917 9.96005 10.9555C10.1419 10.9193 10.3304 10.9379 10.5017 11.0089C10.673 11.0798 10.8194 11.2 10.9224 11.3542C11.0255 11.5083 11.0804 11.6896 11.0804 11.875C11.0804 12.1236 10.9817 12.3621 10.8059 12.5379C10.63 12.7137 10.3916 12.8125 10.1429 12.8125ZM12.6429 6.25H7.64294V4.375C7.64294 3.71196 7.90634 3.07607 8.37518 2.60723C8.84402 2.13839 9.4799 1.875 10.1429 1.875C10.806 1.875 11.4419 2.13839 11.9107 2.60723C12.3796 3.07607 12.6429 3.71196 12.6429 4.375V6.25Z"
                  fill="#D0CCF4" />
          </svg>
          <svg v-else-if="!isCurrent(videoIndex)"
               xmlns="http://www.w3.org/2000/svg"
               width="21"
               height="20"
               viewBox="0 0 21 20"
               fill="none">
            <path d="M19.7245 7.10235L9.69246 17.1336C9.57639 17.2497 9.43857 17.3418 9.2869 17.4046C9.13522 17.4675 8.97266 17.4998 8.80848 17.4998C8.6443 17.4998 8.48173 17.4675 8.33006 17.4046C8.17838 17.3418 8.04057 17.2497 7.92449 17.1336L2.32918 11.5086C2.09518 11.2742 1.96375 10.9566 1.96375 10.6254C1.96375 10.2942 2.09518 9.97655 2.32918 9.74219L4.20418 7.86719C4.4378 7.63351 4.75443 7.50184 5.08486 7.50097C5.41528 7.50009 5.73261 7.63007 5.96746 7.8625L8.82996 10.618L8.83856 10.6266L16.0831 3.48828C16.3174 3.25499 16.6345 3.12402 16.9651 3.12402C17.2957 3.12402 17.6129 3.25499 17.8472 3.48828L19.7222 5.32891C19.8392 5.44493 19.9322 5.58296 19.9957 5.73506C20.0593 5.88715 20.0921 6.05031 20.0923 6.21514C20.0925 6.37997 20.0601 6.54321 19.997 6.69548C19.9339 6.84774 19.8413 6.98602 19.7245 7.10235Z"
                  fill="#D0CCF4" />
          </svg>
          <svg v-else
               xmlns="http://www.w3.org/2000/svg"
               width="25"
               height="24"
               viewBox="0 0 25 24"
               fill="none">
            <path d="M20.6785 6.75H17.3897C17.4263 6.71906 17.4638 6.68906 17.4994 6.65625C17.7841 6.40329 18.0136 6.0943 18.1735 5.74861C18.3333 5.40292 18.4201 5.02796 18.4285 4.64718C18.4408 4.23063 18.3678 3.81595 18.2141 3.42861C18.0603 3.04127 17.8291 2.68944 17.5344 2.39471C17.2398 2.09999 16.888 1.8686 16.5007 1.71474C16.1134 1.56088 15.6988 1.48781 15.2822 1.5C14.9013 1.5082 14.5261 1.59495 14.1803 1.75482C13.8344 1.91468 13.5253 2.14422 13.2722 2.42906C12.922 2.8349 12.6374 3.29291 12.4285 3.78656C12.2196 3.29291 11.9349 2.8349 11.5847 2.42906C11.3317 2.14422 11.0225 1.91468 10.6767 1.75482C10.3308 1.59495 9.95565 1.5082 9.57472 1.5C9.15816 1.48781 8.7435 1.56088 8.35621 1.71474C7.96891 1.8686 7.61715 2.09999 7.32251 2.39471C7.02788 2.68944 6.79659 3.04127 6.64285 3.42861C6.4891 3.81595 6.41615 4.23063 6.42847 4.64718C6.4368 5.02796 6.52361 5.40292 6.68347 5.74861C6.84333 6.0943 7.0728 6.40329 7.35753 6.65625C7.39315 6.68718 7.43065 6.71718 7.46722 6.75H4.17847C3.78064 6.75 3.39911 6.90803 3.11781 7.18934C2.8365 7.47064 2.67847 7.85217 2.67847 8.25V11.25C2.67847 11.6478 2.8365 12.0294 3.11781 12.3107C3.39911 12.592 3.78064 12.75 4.17847 12.75V18.75C4.17847 19.1478 4.3365 19.5294 4.61781 19.8107C4.89911 20.092 5.28064 20.25 5.67847 20.25H11.3035C11.4029 20.25 11.4983 20.2105 11.5686 20.1402C11.639 20.0698 11.6785 19.9745 11.6785 19.875V11.25H4.17847V8.25H11.6785V11.25H13.1785V8.25H20.6785V11.25H13.1785V19.875C13.1785 19.9745 13.218 20.0698 13.2883 20.1402C13.3586 20.2105 13.454 20.25 13.5535 20.25H19.1785C19.5763 20.25 19.9578 20.092 20.2391 19.8107C20.5204 19.5294 20.6785 19.1478 20.6785 18.75V12.75C21.0763 12.75 21.4578 12.592 21.7391 12.3107C22.0204 12.0294 22.1785 11.6478 22.1785 11.25V8.25C22.1785 7.85217 22.0204 7.47064 21.7391 7.18934C21.4578 6.90803 21.0763 6.75 20.6785 6.75ZM8.35128 5.53125C8.22014 5.4125 8.11497 5.26791 8.04237 5.10658C7.96977 4.94525 7.93131 4.77065 7.9294 4.59375C7.92466 4.38647 7.96134 4.18033 8.03728 3.9874C8.11322 3.79448 8.22691 3.61865 8.37167 3.47022C8.51643 3.32179 8.68936 3.20375 8.88032 3.12301C9.07129 3.04226 9.27645 3.00044 9.48378 3H9.52972C9.70662 3.0019 9.88122 3.04037 10.0426 3.11297C10.2039 3.18556 10.3485 3.29073 10.4672 3.42187C11.2538 4.31062 11.5313 5.78437 11.6288 6.69562C10.7138 6.59906 9.24097 6.32156 8.35128 5.53125ZM16.5075 5.53125C15.6178 6.31875 14.1413 6.59625 13.2263 6.69375C13.3378 5.70843 13.6472 4.26562 14.3972 3.42281C14.516 3.29167 14.6605 3.1865 14.8219 3.1139C14.9832 3.0413 15.1578 3.00284 15.3347 3.00093H15.3807C15.588 3.00223 15.793 3.0449 15.9836 3.12644C16.1743 3.20798 16.3467 3.32675 16.4909 3.47579C16.635 3.62483 16.748 3.80115 16.8231 3.99441C16.8983 4.18766 16.9341 4.39397 16.9285 4.60125C16.9254 4.77695 16.8863 4.95016 16.8136 5.11013C16.7409 5.2701 16.636 5.41344 16.5057 5.53125H16.5075Z"
                  fill="white" />
          </svg>
        </q-btn>
        <div v-if="isCurrent(videoIndex)"
             class="curren-info">
          <div class="curren-info-title">
            نکته
            {{ videoIndex }}
            از ۷
          </div>
          <div class="curren-info-caption">
            {{ video.coupon_display_title }}
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script>
import { defineComponent } from 'vue'
import { BlackFridayCampaignData } from 'src/models/BlackFridayCampaignData.js'

export default defineComponent({
  name: 'StepSection',
  props: {
    blackFridayCampaignData: {
      type: BlackFridayCampaignData,
      default: new BlackFridayCampaignData()
    }
  },
  data () {
    return {

    }
  },
  computed: {
    localBlackFridayCampaignData: {
      get () {
        return this.blackFridayCampaignData
      },
      set (newValue) {
        this.$emit('update:blackFridayCampaignData', newValue)
      }
    },
    selectedVideo () {
      if (this.localBlackFridayCampaignData.videos.list.length === 0) {
        return null
      }

      const selectedIndex = this.localBlackFridayCampaignData.videos.list.findIndex(video => video.selected) || 0

      return this.localBlackFridayCampaignData.videos.list[selectedIndex]
    }
  },
  methods: {
    onSelectStep (videoIndex) {
      this.$emit('onSelectStep', videoIndex)
    },
    isCurrent (videoIndex) {
      if (this.localBlackFridayCampaignData.videos.list.length === 0) {
        return false
      }

      const lastActiveIndex = this.getLastActiveIndex()

      return videoIndex === lastActiveIndex
    },
    getLastActiveIndex () {
      let activeIndex = 0
      this.localBlackFridayCampaignData.videos.list.forEach((video, videoIndex) => {
        if (video.is_actice && activeIndex < videoIndex) {
          activeIndex = videoIndex
        }
      })

      return activeIndex
    }
  }
})

</script>

<style scoped lang="scss">
.StepSection {
  display: flex;
  justify-content: center;
  .items {
    display: flex;
    flex-flow: row;
    align-items: center;
    justify-content: space-between;
    position: relative;
    width: 1130px;
    padding-top: 50px;
    padding-bottom: 78px;
    @media screen and (max-width: 1439px) {
      width: 964px;
    }
    @media screen and (max-width: 1023px) {
      width: 540px;
      padding-top: 48px;
    }
    @media screen and (max-width: 599px) {
      width: 100%;
      max-width: 100%;
      overflow-x: auto;
      flex-wrap: nowrap;
      justify-content: flex-start;
      padding-bottom: 86px;
      padding-top: 40px;
    }
    .item {
      position: relative;
      z-index: 1;
      &:after {
        content: ' ';
        position: absolute;
        z-index: -1;
        height: 24px;
        left: 5px;
        top: calc( 50% - 12px );
        width: 160px;
        background: #19172E;
        @media screen and (max-width: 1439px) {
          width: 140px;
        }
        @media screen and (max-width: 1023px) {
          width: 75px;
          height: 20px;
          top: calc( 50% - 10px );
        }
      }
      &:last-child {
        &:after {
          display: none;
        }
      }
      .q-btn {
        width: 56px;
        height: 56px;
        padding: 18px;
        @media screen and (max-width: 1023px) {
          width: 48px;
          height: 48px;
          padding: 15px;
        }
        border-radius: 100px;
        background: #5E57AC;
        box-shadow: 0 0 32px 0 rgba(51, 51, 51, 0.09);
      }
      &.current {
        position: relative;
        .q-btn {
          width: 64px;
          height: 64px;
          padding: 20px;
          @media screen and (max-width: 1023px) {
            width: 56px;
            height: 56px;
            padding: 18px;
          }
          border-radius: 100px;
          background: #D14835;
          box-shadow: 0 0 50px 0 rgba(85, 32, 24, 0.32);
        }
        .curren-info {
          position: absolute;
          top: calc( 64px + 24px );
          left: calc( (75px - 32px) * -1 );
          width: 150px;
          text-align: center;
          .curren-info-title {
            color: #D75F4E;
            text-align: center;
            font-family: ModamFaNumWeb,serif;
            font-size: 20px;
            font-style: normal;
            font-weight: 700;
            line-height: normal;
            letter-spacing: -0.6px;
          }
          .curren-info-caption {
            color: #FFF;
            text-align: center;
            font-family: ModamFaNumWeb,serif;
            font-size: 18px;
            font-style: normal;
            font-weight: 400;
            line-height: normal;
            letter-spacing: -0.54px;
          }
        }
      }
      @media screen and (max-width: 599px) {
        margin-right: 18px;
        &:first-child {
          margin-left: 20px;
        }
      }
    }
  }
}
</style>
